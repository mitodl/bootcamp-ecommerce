db:
  image: postgres
  ports:
    - "5432"
web:
  build: .
  command: >
    /bin/bash -c '
    sleep 3 &&
    python3 manage.py migrate &&
    ./with_host.sh python3 manage.py runserver 0.0.0.0:8099'
  environment:
    DEBUG: 'False'
    COVERAGE_DIR: htmlcov
    PORT: 8099
    NODE_ENV: 'production'
    DATABASE_URL: postgres://postgres@db:5432/postgres
    BOOTCAMP-ECOMMERCE_SECURE_SSL_REDIRECT: 'False'
    BOOTCAMP-ECOMMERCE_DB_DISABLE_SSL: 'True'
  ports:
    - "8099:8099"
  links:
    - db

watch:
  image: node:6.2
  working_dir: /src
  command: >
    /bin/bash -c './webpack_if_prod.sh'
  ports:
    - "8098:8098"
  volumes:
    - .:/src
  environment:
    NODE_ENV: 'production'
